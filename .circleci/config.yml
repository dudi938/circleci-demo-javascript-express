version: 2
jobs:
  build:
    working_directory: ~/test_folder
    docker:
      - image: circleci/node:4.8.2
      - image: mongo:3.4.4
    steps:
      - checkout
      - run:
          name: test encrypt variables
          command: echo ${AZURE_USER_NAME}
      - run:
          name: set script excecutable
          command: sudo chmod +x ./install_powershell_core ./CustomTasks/slack_integration/slack_messanger
      - run:
          name: install powershell core
          command: ./install_powershell_core
      - run:
          name: Log in to azure
          command: ${LOGIN_COMMAND}
      - run:
          name: Deploy linux VM
          command: az group deployment create --name ExampleDeployment --resource-group ${RESOURCE_GROUP} --template-file "${TEMPLATE_FILE_PATH}" --parameters "${PARAMETERS_FILE_PATH}"
      - run:
          name: end build notification
          command: ./CustomTasks/slack_integration/slack_messanger ${SLACK_WEBHOOK_URI} dsd efesf efesfe "New vm was deployed." desktop_computer


